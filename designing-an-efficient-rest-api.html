<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta name="author" content="Romain Pellerin" />
        <meta name="keywords" content="romain pellerin, romain, pellerin, portfolio, site personnel, personal website, blog, javascript, code, api, http, rest, express, json, web" />
        <meta name="geo.placename" content="San Francisco, California, USA" />
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="robots" content="all" />
        <link rel="preconnect" href="https://fonts.googleapis.com">
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:ital,wght@0,400..900;1,400..900&display=swap" rel="stylesheet">
        <link rel="stylesheet" href="https://romainpellerin.eu/theme/css/main.css" type="text/css" />
        <link rel="shortcut icon" href="https://romainpellerin.eu/favicon.ico" />
        <script async src="https://www.googletagmanager.com/gtag/js?id=G-711TXDHP4Q"></script>
        <script>
        function _dntEnabled(dnt, userAgent) {
            'use strict';

            // for old version of IE we need to use the msDoNotTrack property of navigator
            // on newer versions, and newer platforms, this is doNotTrack but, on the window object
            // Safari also exposes the property on the window object.
            var dntStatus = dnt || navigator.doNotTrack || window.doNotTrack || navigator.msDoNotTrack;
            var ua = userAgent || navigator.userAgent;

            // List of Windows versions known to not implement DNT according to the standard.
            var anomalousWinVersions = ['Windows NT 6.1', 'Windows NT 6.2', 'Windows NT 6.3'];

            var fxMatch = ua.match(/Firefox\/(\d+)/);
            var ieRegEx = /MSIE|Trident/i;
            var isIE = ieRegEx.test(ua);
            // Matches from Windows up to the first occurance of ; un-greedily
            // http://www.regexr.com/3c2el
            var platform = ua.match(/Windows.+?(?=;)/g);

            // With old versions of IE, DNT did not exist so we simply return false;
            if (isIE && typeof Array.prototype.indexOf !== 'function') {
                return false;
            } else if (fxMatch && parseInt(fxMatch[1], 10) < 32) {
                // Can't say for sure if it is 1 or 0, due to Fx bug 887703
                dntStatus = 'Unspecified';
            } else if (isIE && platform && anomalousWinVersions.indexOf(platform.toString()) !== -1) {
                // default is on, which does not honor the specification
                dntStatus = 'Unspecified';
            } else {
                // sets dntStatus to Disabled or Enabled based on the value returned by the browser.
                // If dntStatus is undefined, it will be set to Unspecified
                dntStatus = { '0': 'Disabled', '1': 'Enabled' }[dntStatus] || 'Unspecified';
            }
            return dntStatus === 'Enabled' ? true : false;
        }
        if (!_dntEnabled()) {
            window.dataLayer = window.dataLayer || [];
            function gtag(){dataLayer.push(arguments);}
            gtag('js', new Date());

            gtag('config', 'G-711TXDHP4Q');
        }
        </script>

        <!-- Social media -->
        <meta name="description" content="How to write beautiful and efficient REST APIs" />
        <meta property="og:image" content="https://romainpellerin.eu/theme/img/romain_pellerin-4x.jpg" />
        <meta property="og:title" content="Designing An Efficient REST API - Romain Pellerin's Blog" />
        <meta property="og:description" content="How to write beautiful and efficient REST APIs" />
        <meta property="og:url" content="https://romainpellerin.eu/designing-an-efficient-rest-api.html" />

        <title>Designing An Efficient REST API - Romain Pellerin's Blog</title>

        <link href="//romainpellerin.eu/feeds/atom.xml" type="application/atom+xml" rel="alternate" title="Romain Pellerin's Blog Atom Feed" />
        <link href="//romainpellerin.eu/feeds/rss.xml" type="application/rss+xml" rel="alternate" title="Romain Pellerin's Blog RSS Feed" />
    </head>
    <body>
        <div id="wrapper">

<nav class="flexbox-row">
    <a class="center" href="https://romainpellerin.eu/">Homepage</a>
    <span class="center">|| Blog:</span>
    <a class="center" href="https://romainpellerin.eu/archives.html">All articles</a>
    <a class="center" href="https://romainpellerin.eu/categories.html">Categories</a>
    <a class="center" href="https://romainpellerin.eu/tags.html">Tags</a>
    <a class="center" href="//romainpellerin.eu/feeds/rss.xml">RSS feed</a>
    <a class="center" href="//romainpellerin.eu/feeds/atom.xml">Atom feed</a>
</nav><header class="article-header center">
    <p id="back-line" class="small grey"><span>
<time datetime="2015-09-24T18:00:00+02:00">Thu 24 September 2015</time> - Last update: <time datetime="2022-09-24T12:11:00+02:00">Sat 24 September 2022</time>        </p>
    <h1>Designing An Efficient REST API</h1>
    <div class="grey">
        <p class="italic">How to write beautiful and efficient REST APIs</p>
        <p class="small">
            &#128338; <span title="Based on a 200 words per minute reading speed. This article has a total of 3841 words.">19 min read</span>
        </p>
<p class="small">Category: <a title="Go to the category" href="https://romainpellerin.eu/category/code.html">Code</a></p><p class="small">Tags: <a title="Go to the tag" href="https://romainpellerin.eu/tag/javascript.html">javascript</a>, <a title="Go to the tag" href="https://romainpellerin.eu/tag/code.html">code</a>, <a title="Go to the tag" href="https://romainpellerin.eu/tag/api.html">api</a>, <a title="Go to the tag" href="https://romainpellerin.eu/tag/http.html">http</a>, <a title="Go to the tag" href="https://romainpellerin.eu/tag/rest.html">rest</a>, <a title="Go to the tag" href="https://romainpellerin.eu/tag/express.html">express</a>, <a title="Go to the tag" href="https://romainpellerin.eu/tag/json.html">json</a>, <a title="Go to the tag" href="https://romainpellerin.eu/tag/web.html">web</a></p>    </div>
</header>
<article>
    <p><strong>TL;DR</strong>: see the bottom.</p>
<p>Most of the time, the only purpose of an API is to give clients (a mobile application, a web site, a software program, a web browser, etc) access to a remote database (thus a server), for storing data (or making complex calculations sometimes).
<strong>The scheme is very simple: the server waits for incoming requests and responds accordingly. On the other hand, clients occasionally send requests, either to perform an action (saving, updating or deleting data), or to retrieve data.</strong></p>
<p>When it comes to designing and implementing an (REST) API, you might be seeking a standard to follow (<a href="http://jsonapi.org/">some people are trying to create a standard</a>) or some <a href="http://www.vinaysahni.com/best-practices-for-a-pragmatic-restful-api">best practices</a> to apply. You might also wonder which language and which framework to use (don't <a href="https://en.wikipedia.org/wiki/Reinventing_the_wheel">reinvent the wheel</a> dude!). Actually, there are plenty of them. From the "<em>do it from scratch in Java</em>" to the "<em>use this all-in-one Javascript framework</em>", you have a lot of choices.</p>
<p>I've experienced real API development with two languages so far, <strong>Javascript</strong> and <strong>Scala</strong>. With the former, I used the well-known <a href="http://expressjs.com/">Express framework</a>. With the latter, I used the equally well known <a href="https://www.playframework.com/">Play Framework</a> in its version 2.<br>
I also used <a href="https://github.com/rpellerin/php-mvc-base">PHP</a> and Java without any framework.</p>
<p>But that's not our purpose in this article. Let's move on to the big question, "<em>How to design an efficient REST API</em>". Then, we'll have a quick look at <a href="http://expressjs.com/">Express</a>, a famous Javascript framework and one of the best for APIs, in my opinion.</p>
<p>In this article, I'll try to follow what <a href="http://martinfowler.com/articles/richardsonMaturityModel.html">someone once wrote beautifully</a>, in order to introduce REST APIs, and gradually explain how to improve them. I assume you - the reader - have some knowledge of the HTTP protocol.</p>
<p><a href="https://www.ssllabs.com/">It goes without saying that you <strong>must use HTTPS</strong> to ensure privacy. This way, everything will be encrypted and anyone sniffing the network won't be able to see the content of your requests or responses.</a> Let's dive into REST APIs now!</p>
<h1 id="you-said-rest">You said "<em>REST</em>"?</h1>
<p>In "<em>REST API</em>", "<em>REST</em>" stands for "<em>Representational State Transfer</em>", which is the software architectural style of the web. Basically, this means that any REST API relies on the HTTP protocol (and by extension HTTPS). As a consequence, the first step is to understand all the strengths and weaknesses of HTTP in order to use everything it has to offer. I will only be referring to HTTP version 1.1 in this article, since version 2 is still hardly used overall, and quite badly supported.</p>
<h1 id="its-all-about-resources">It's all about resources</h1>
<p>URLs (<em>Uniform Resource Locator</em>) represent resources. When designing an API, think about it as resource containers. Every end-point should represent either <strong>a resource</strong> or <strong>a list of resources</strong>. Following this, there must be <strong>two-end points per resource</strong>, the resource collection, and an individual resource within the collection:</p>
<div class="highlight"><pre><span></span><code>/myresource
/myresource/{id}
</code></pre></div>

<p>If our API is hosted at <a href="https://my-api.com">https://my-api.com</a>, then we've just created the end-points <a href="https://my-api.com/myresource">https://my-api.com/myresource</a> and <a href="https://my-api.com/myresource/id">https://my-api.com/myresource/{id}</a>. But let's try to avoid abstraction and use real examples.</p>
<p>We are developing a website where registered users can upload pictures. So, we need two end-points for our two entities:</p>
<div class="highlight"><pre><span></span><code>/users
/pictures
</code></pre></div>

<p>Those two end-points will then allow us to get the list of either all the users, or all the pictures. Now, what if we want to know the categories of the pictures? We also need to access individual resources. Let's create other end-points:</p>
<div class="highlight"><pre><span></span><code>/users/{id}
/pictures/{id}
/pictures/categories
/pictures/categories/{id}
</code></pre></div>

<p>The important thing here, is to understand that <code>{id}</code> is a resource's unique identifier. For users, we retrieved these unique identifiers thanks to the <code>/users</code> end-point (which had given us the list of users). So, <code>/users/{id}</code> will give us all the details about ONE resource, the targeted user. The same rule applies for any other collection of resources.</p>
<p>Also, <code>/pictures/categories</code> represent a list of resources, in our case a list of categories. But this list belongs to a "bigger" resource, a container, <code>/pictures</code>. It's a <strong>hierarchy</strong>. This way, we are going to get all the possible categories for any picture.</p>
<p>Now, let's add a feature: users can send messages to each other. How do we get all the messages sent by a specific user? And a specific message sent by a specific user? Like this:</p>
<div class="highlight"><pre><span></span><code>/users/{userId}/messages
/users/{userId}/messages/{messageId}
</code></pre></div>

<h2 id="naming-convention">Naming convention</h2>
<p>To remain consistent, try to use the plural form of every word used for your end-points, it will make things easier. <a href="https://en.wikipedia.org/wiki/CamelCase"><em>camelCase</em></a> is also a good practice, when necessary (but we always try to use simple single words).</p>
<h1 id="methods-also-called-verbs">Methods (also called verbs)</h1>
<p>One of the biggest strengths of HTTP is <a href="http://www.w3.org/Protocols/rfc2616/rfc2616-sec9.html">its verbs</a>. The most popular are GET and POST. The latter is mostly used for asynchronous calls (AJAX) or forms in web pages, whereas the former is used every time a page is accessed or reloaded from a browser.</p>
<p>So, what are the equivalent verbs for our old friend called <em>CRUD</em> (Create, Read, Update and Delete)? <strong>PUT</strong>, <strong>GET</strong>, <strong>POST</strong> and <strong>DELETE</strong>. Consequently, any well designed REST API must make use of at least these four verbs. And yes, HTTP has more <a href="http://www.w3.org/Protocols/rfc2616/rfc2616-sec9.html">than four verbs</a>.</p>
<p>For example, this is how to create, get, update and delete a specific user:</p>
<div class="highlight"><pre><span></span><code>POST   /users      <span class="c1"># Create</span>
PUT    /users/<span class="o">{</span>id<span class="o">}</span> <span class="c1"># Create</span>
GET    /users/<span class="o">{</span>id<span class="o">}</span> <span class="c1"># Get</span>
PUT    /users/<span class="o">{</span>id<span class="o">}</span> <span class="c1"># Update</span>
DELETE /users/<span class="o">{</span>id<span class="o">}</span> <span class="c1"># Delete</span>
</code></pre></div>

<p>Here, the important thing is that <code>PUT</code> is used to create a <strong>specific resource</strong> (a user), whose identifier has been chosen by the client. Then, the second <code>PUT</code> updates the newly created resource. <strong><code>POST</code> is only dedicated to creating resources</strong>, unlike <code>PUT</code> that will mostly be used to update, but can also be used to create. When you want to create a resource without specifying its identifier, use <code>POST</code>, like in the first line, where a user is signing up (then the API will create an identifier for this user). Logging in would be achieved like this:</p>
<div class="highlight"><pre><span></span><code>POST /users/login
</code></pre></div>

<p><a href="http://www.restapitutorial.com/">More information about verbs</a>.</p>
<h1 id="understanding-http">Understanding HTTP</h1>
<p>At this point, I need to add some explanation about the HTTP protocol. Every HTTP transaction (request or response) is made of three main parts:</p>
<ul>
<li>An initial line</li>
<li>Some headers</li>
<li>The body, separated from the headers by a blank line</li>
</ul>
<p>For requests, the initial line is made of a verb, a URL and the HTTP version used. For instance:</p>
<div class="highlight"><pre><span></span><code>GET /users HTTP/1.1
</code></pre></div>

<p>On the other hand, for responses, it's a bit different: the HTTP version, a response status code and an English reason phrase describing the status code, like in the following example:</p>
<div class="highlight"><pre><span></span><code>HTTP/1.1 404 Not Found
</code></pre></div>

<p>A typical simple request would look like this:</p>
<div class="highlight"><pre><span></span><code>POST /users/123 HTTP/1.1
Host: my-api.com
Content-Type: application/x-www-form-urlencoded

name=Jon&amp;lastName=Snow
</code></pre></div>

<p>And a (non-related) response (I chose a random header):</p>
<div class="highlight"><pre><span></span><code>HTTP/1.1 200 OK
Expires: Thu, 24 Sep 2015 19:36:25 GMT

Hello world
</code></pre></div>

<p>That said, let’s get back to APIs.</p>
<p>In the previous sections we learned the correct use of the HTTP verbs, so now let's talk about the body and the status code. Headers will come later.</p>
<h1 id="transmitting-data">Transmitting data</h1>
<p>How can a client update a user on the server? What if someone wants to update their biography for example? Or wants to mention their age? Likewise, how does the server respond and send data back to clients? Here come the status codes and the body.</p>
<p>Basically, clients need to send <strong>one type of information</strong> in the body: data to be put into the remote database, via a <strong>PUT</strong> or <strong>POST</strong> request. It can be either to create a new resource or to update it (it depends on the HTTP verb used).</p>
<p>On the other hand, the server can send different types of information:</p>
<ul>
<li>Via the status code:</li>
<li>How the request was handled</li>
<li>In headers:</li>
<li>Metadata</li>
<li>In the body:</li>
<li><strong>A resource</strong> or <strong>a list of resources</strong>, in response to a <strong>GET</strong> request.</li>
<li><strong>Some details about a resource</strong> newly created, in response to a <strong>PUT</strong> or <strong>POST</strong> request. For example, the resource's unique identifier or URL, to access this resource.</li>
</ul>
<p>As you can see, the body is only dedicated to the requested resources(s). That's all. All other useful information <strong>must</strong> be transmitted via the HTTP status code or headers.</p>
<h2 id="the-status-code">The status code</h2>
<p>Want to tell the client the resource has been created? Use the code 201. Want to say something went wrong? 500. Forbidden? 403. Resource not found? 404. <a href="https://en.wikipedia.org/wiki/List_of_HTTP_status_codes">Choose the right one</a>.</p>
<p>Here are the most used status codes for an API:</p>
<table>
<thead>
<tr>
<th>Status code</th>
<th>Used in response to</th>
</tr>
</thead>
<tbody>
<tr>
<td>200 OK</td>
<td>GET</td>
</tr>
<tr>
<td>201 Created</td>
<td>PUT (when creating a resource), POST</td>
</tr>
<tr>
<td>202 Accepted</td>
<td>PUT, POST</td>
</tr>
<tr>
<td>204 No Content</td>
<td>PUT, DELETE</td>
</tr>
<tr>
<td>301 Moved Permanently</td>
<td>GET, PUT, POST</td>
</tr>
<tr>
<td>400 Bad request</td>
<td>Any</td>
</tr>
<tr>
<td>401 Unauthorized</td>
<td>Any</td>
</tr>
<tr>
<td>403 Forbidden</td>
<td>Any</td>
</tr>
<tr>
<td>404 Not Found</td>
<td>GET, PUT (when updating), DELETE</td>
</tr>
<tr>
<td>500 Internal Server Error</td>
<td>Any</td>
</tr>
</tbody>
</table>
<p>The HTTP protocol is very flexible, allowing us to use any non existing code if needed and relevant, when none of them fits our needs. For example, the range 550-599 can be used freely, the way you want.</p>
<p><a href="http://i.stack.imgur.com/whhD1.png">Need help in choosing the correct status code?</a></p>
<h2 id="the-body">The body</h2>
<p>Sending parameters, from HTML forms, is pretty easy, it's a key-value thing, where parameters are separated by "&amp;", like this:</p>
<div class="highlight"><pre><span></span><code>firstName=Jon&amp;lastName=Snow
</code></pre></div>

<p>Here, there's no recommended convention. I used camelCase (as shown above) without any particular reason. Choose one and be consistent.</p>
<p>However, out of the context of HTML forms, how to format the body? Well, one could say we could use the same key-value format, but actually, it's not a good idea. Let's see what options we have.</p>
<h3 id="a-historic-battle-xml-vs-json-or-soap-vs-rest">A historic battle: XML vs. JSON or SOAP vs. REST</h3>
<p>You have two main options: XML or JSON. Nowadays, a lot of people use JSON. I won't try to defend JSON here, please <a href="http://www.json.org/xml.html">read this comparison</a> or <a href="http://www.json.org/">the official description</a>.</p>
<p>To briefly sum it up, JSON brings efficiency, lightness and high-readability in a single format. Additionally, it's extremely easy to parse with any language, thanks to a great integration and a lot of support. It’s definitely the most popular format when dealing with APIs. You can easily create a single object or an array of objects.</p>
<p>Just keep in mind that JSON is probably your best ally.</p>
<h2 id="a-particular-header">A particular header</h2>
<p>Earlier on, we saw that the second part of every HTTP request is the headers section. Let me introduce one of them, probably the most important one: <code>Content-Type</code>.</p>
<p>Its only purpose is to specify what kind of data we are sending. Consequently, in our case, this header should be like:</p>
<div class="highlight"><pre><span></span><code>Content-Type: application/json
</code></pre></div>

<p>Basically, its value is just a <a href="https://en.wikipedia.org/wiki/Media_type">MIME type</a>.</p>
<h1 id="real-world-example">Real world example</h1>
<p>A <strong>POST</strong> request sent by the client:</p>
<div class="highlight"><pre><span></span><code>POST /users HTTP/1.1
Host: my-api.com
Content-Type: application/json

{
    &quot;name&quot;: &quot;Jon Snow&quot;,
    &quot;bad_guys_killed&quot;: 200,
    &quot;skills&quot;:
        [
            {&quot;name&quot;: &quot;Warrior&quot;},
            {&quot;name&quot;: &quot;Member of the Night&#39;s Watch&quot;}
        ],
    &quot;is_a_badass&quot;: true
}
</code></pre></div>

<p>Basically, its value is just a MIME type. To such a request, the response the server would send back:</p>
<div class="highlight"><pre><span></span><code>HTTP/1.1 201 Created
Content-Type: application/json

{
    &quot;id&quot;: 123
}
</code></pre></div>

<p>We can see that the server created the resource (thanks to the status code). It also gives us its ID, JSON-formatted. Then, we can do:</p>
<div class="highlight"><pre><span></span><code>GET /users/123 HTTP/1.1
Host: my-api.com
</code></pre></div>

<p>We would get:</p>
<div class="highlight"><pre><span></span><code>HTTP/1.1 200 OK
Content-Type: application/json

{
    &quot;id&quot;: 123,
    &quot;name&quot;: &quot;Jon Snow&quot;,
    &quot;bad_guys_killed&quot;: 200,
    &quot;skills&quot;:
        [
            {&quot;name&quot;: &quot;Warrior&quot;},
            {&quot;name&quot;: &quot;Member of the Night&#39;s Watch&quot;}
        ],
    &quot;is_a_badass&quot;: true,
    &quot;created_at&quot;: &quot;2015-09-02T17:05:22.996Z&quot;,
    &quot;updated_at&quot;: &quot;2015-09-02T17:05:22.996Z&quot;
}
</code></pre></div>

<hr>
<p>At this point, our API is able to do the four basic operations we needed (<a href="https://en.wikipedia.org/wiki/Create,_read,_update_and_delete">CRUD</a>, remember?), on any kind of entity, easily, thanks to a pretty format, JSON. End-points are semantic and hierarchically ordered. Everything is perfect.</p>
<div style="text-align: center">
<img src="https://romainpellerin.eu/images/api-unicorn.gif" alt="A gif showing a unicorn" style="width: 150px; height: auto" />
</div>

<p>But... (there's always a <em>but</em>).</p>
<p>We don't take advantage of all the strengths of HTTP. Headers, you remember? And what if we want to apply some filters to our <strong>GET</strong> requests? Sorting? What about pagination? Getting your 1M users in a single response body isn't a good idea, trust me.</p>
<p>More importantly, what about security? Authentication? But first, let's talk about HATEOAS...</p>
<h1 id="hateoas-the-holy-grail"><a href="http://putaindecode.fr/posts/api/hateoas/">HATEOAS, the Holy Grail</a></h1>
<p>Most of the time, to access a specific resource, you need to:</p>
<ol>
<li>Get the list of resources, e.g. <code>GET /users</code></li>
<li>Find the unique identifier of the targeted resource in this list</li>
<li>Construct its URL, often https://&lt;domain&gt;/&lt;list-of-resources&gt;/&lt;id&gt;, e.g. <code>https://my-api.com/users/123</code></li>
<li>Finally, do <code>GET /users/123</code></li>
</ol>
<p>Another approach would be providing directly every resource's URL in the list (among other links if necessary), like this:</p>
<div class="highlight"><pre><span></span><code>[
    {
        &quot;id&quot;: 123,
        name: &quot;Jon Snow&quot;,
        &quot;links&quot;:
            [
                {
                    &quot;rel&quot;: &quot;self&quot;,
                    &quot;href&quot;: &quot;https://my-api.com/users/123&quot;
                },
                {
                    &quot;ref&quot;: &quot;list&quot;,
                    &quot;href&quot;: &quot;https://my-api.com/users&quot;
                }
            ],
        &quot;bad_guys_killed&quot;: 200,
        ...
    },
    {
        &quot;id&quot;: 124,
        ...
    }
]
</code></pre></div>

<p>Instead of providing the full URL, you might as well only provide the path name:</p>
<div class="highlight"><pre><span></span><code>&quot;links&quot;:
    [
        {
            &quot;rel&quot;: &quot;self&quot;,
            &quot;href&quot;: &quot;/users/123&quot;
        },
        ...
    ]
</code></pre></div>

<p>I'm not a huge fan of HATEOAS. I believe that an API should be consistent in its manner of accessing resources. I like to assume that, as soon as I know a resource's unique identifier, I can access it by constructing its URL, as I explained above. So, I don't need the links, I can construct them by myself.</p>
<p><strong>But I'm wrong</strong>. This is definitely the best way to do. It adds a layer of abstraction. If one day you change the way to access a resource (not with a unique identifier anymore, but with a token, or an email address, or anything), if you always provided the link for each resource, the change would be transparent for your users.</p>
<h1 id="headers-are-metadata">Headers are metadata</h1>
<p>A great thing to consider is that the body <strong>must</strong> only contain the requested resource(s). Any other piece of information must go to the headers. Furthermore, you can create any header you want.</p>
<h2 id="authentication">Authentication</h2>
<p>There are two major concepts under the name of <em>authentication</em>.</p>
<ul>
<li>Sign up/Log in/Log out: <strong>user management</strong></li>
<li>Authorization: <strong>restricting the access to the API</strong></li>
</ul>
<p>User management can be be achieved with cookies. This way, you can restrict some end-points to logged in users only.</p>
<p>In parallel, you might want to restrict the entire API to specific clients. One could say "<em>Use basic authentication</em>", but that doesn't really fit our need since it's not the original purpose of basic auth.</p>
<p>What you can do instead is quite easy: create as many HTTP headers as you want and send (secret) keys on every request. For example, let's create a key to make sure we're accessing the right app, and another one to define the access level granted:</p>
<div class="highlight"><pre><span></span><code>POST /users HTTP/1.1
Host: my-api.com
Content-Type: application/json
Security-APP-ID: 123456
Security-Access-Level: 3

{
    &quot;name&quot;: &quot;Jon Snow&quot;
}
</code></pre></div>

<p>Obviously, as I said in the beginning of this article, all of this doesn't make sense at all if you don't use HTTPS (and force it!). You really don't want to expose such keys to anyone on the network.</p>
<p><a href="http://restcookbook.com/Basics/loggingin/">More information about authentication</a> and about <a href="http://blog.slaks.net/2015-10-13/web-authentication-arms-race-a-tale-of-two-security-experts/">security in general</a>.</p>
<h2 id="location">Location</h2>
<p>Another useful header is <code>Location</code>. A good practice is to use it after creating a resource with <strong>POST</strong>, to give back the location of the resource newly created. This way, no body is needed and your API can respond with a status code <em>201 Created</em>, without a body. For example, after creating the user <em>Jon Snow</em>, we would get:</p>
<div class="highlight"><pre><span></span><code>HTTP/1.1 201 Created
Location: https://my-api.com/users/123
</code></pre></div>

<p>The protocol and domain are optional, we could just send <code>/users/123</code>.</p>
<h2 id="other-useful-piece-of-information">Other useful piece of information</h2>
<p>Basically, you can create as many custom headers as you want. A good practice with end-points returning a list of resources, is to give the total number of records in the database when relevant, via a header. You may wonder why, since we can programmatically count the number of results. But, as I will explain it in the next section, you are never going to return the full list of results in a single response.</p>
<p>So, this is an example of a header specifying the number of rows. The request:</p>
<div class="highlight"><pre><span></span><code>GET /users HTTP/1.1
Host: my-api.com
</code></pre></div>

<p>The response:</p>
<div class="highlight"><pre><span></span><code>HTTP/1.1 200 OK
Content-Type: application/json
Total-Rows: 7897

[
    {
        id: 1,
        ...
    },
    ...
]
</code></pre></div>

<h1 id="pagination">Pagination</h1>
<p><strong>When returning a list of resources</strong>, above a certain number or results, you should split your response in pages. It's a good practice for reducing waiting time and the weight of responses. Moreover, you might not need the whole list at once. Depending on the amount of details provided for each resource, a general rule would be returning between 100 and 1000 results per request as a maximum.</p>
<p>Requesting a page is as simple as providing a query parameter:</p>
<div class="highlight"><pre><span></span><code>GET /users?page=3
</code></pre></div>

<p>On the server side, you would just skip the <em>&lt;number-of-results-per-page&gt;*&lt;number-of-page&gt;</em> first users. Pages start at 0.</p>
<p>For instance, if you return 100 users per request, with page 0 you would skip no one and simply returns the first 100 users (from 0 to 99). On page 1, you skip the first 100 users from your database and return the users from 100 to 199, and so on.</p>
<p>But there's a problem...</p>
<p>Let's say you have 10 users in your database. Every <code>GET /users</code> returns 3 users at most, sorted by age.</p>
<p>In SQL, this would be something like:</p>
<div class="highlight"><pre><span></span><code><span class="k">SELECT</span><span class="w"> </span><span class="n">id</span><span class="p">,</span><span class="w"> </span><span class="n">name</span><span class="p">,</span><span class="w"> </span><span class="n">age</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">users</span><span class="w"> </span><span class="k">ORDER</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">AGE</span><span class="w"> </span><span class="k">LIMIT</span><span class="w"> </span><span class="mi">3</span><span class="w"> </span><span class="k">OFFSET</span><span class="w"> </span><span class="n">x</span><span class="p">;</span><span class="w"></span>
<span class="cm">/* where x equals 3*&lt;number of page&gt; */</span><span class="w"></span>
</code></pre></div>

<p>You'll then have 3 pages.</p>
<table>
<thead>
<tr>
<th>Page 0</th>
<th>Page 1</th>
<th>Page 2</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>45,</strong> Jon, 20</td>
<td><strong>55,</strong> Alice, 30</td>
<td><strong>99,</strong> Pete, 37</td>
</tr>
<tr>
<td><strong>87,</strong> Laura, 23</td>
<td><strong>9,</strong> Bob, 33</td>
<td><strong>1,</strong> Cindy, 39</td>
</tr>
<tr>
<td><strong>3,</strong> Jean, 25</td>
<td><strong>2,</strong> Helen, 36</td>
<td><strong>78,</strong> Max, 40</td>
</tr>
</tbody>
</table>
<p>Here is a scenario:</p>
<ol>
<li><code>GET /users?page=0</code>: fine, you get results from Jon (id 45) to Jean (id 3).</li>
<li>A new user (Mary) signs up on your website/mobile application, aged of 24.</li>
<li><code>GET /users?page=1</code>: you get results from Jean to Bob. You got the same person twice (Jean), this is a problem.</li>
</ol>
<h2 id="what-happened">What happened?</h2>
<p>As Mary is 24 and the API returns results sorted by age, Mary would be returned on page 0, which shifts Jean to page 1.</p>
<p>A good way to solve this problem is to create a pagination based on an entity (here, a user). Instead of requesting a particular page, you would say to the API "<em>give me results after this user</em>" or "<em>before this user</em>". Let me explain it by replaying our scenario:</p>
<ol>
<li><code>GET /users</code>: no pagination specified, fine, you get results from Jon (id 45) to Jean (id 3)</li>
<li>A new user (Mary) signs up on your website/mobile application, aged of 24.</li>
<li><code>GET /users?pageAfter=3</code>: since the last person of our previous results had an id of 3, we request the users <strong>after</strong> that ID. This way, we make sure we won't get duplicated results.</li>
</ol>
<p>To achieve this, you can either write a more complex SQL query of simply do the pagination programmatically.</p>
<p>The only problem that still remains is that, by doing this, we have no way to retrieve Mary, except if we request page 0 again, by doing this, for example:</p>
<div class="highlight"><pre><span></span><code>GET /users?pageBefore=3
</code></pre></div>

<p>Two last things:</p>
<ul>
<li>Always enable pagination, even if your entire collection is small and will never grow. Like this, you API's users won't get lost. The API remains consistent.</li>
<li>If a page returns this entire collection, use the status code 200. Otherwise, use the status code 206 (<em>Partial Content</em>)</li>
</ul>
<p><a href="http://metabates.com/2012/02/22/adding-pagination-to-an-api/">More information about pagination</a>.</p>
<h1 id="filtering-and-sorting">Filtering and sorting</h1>
<p>Every end-point that returns a list of resource should allow filtering on fields, as well as sorting. The following request should be possible:</p>
<div class="highlight"><pre><span></span><code>GET /users?country=US&amp;age=21&amp;sortBy=name
</code></pre></div>

<p>We request all the users from the US, aged of 21, sorted by name. The inner mechanism is up to the developers.</p>
<hr>
<p>We're done! Now, you know how to build efficient and robust APIs.</p>
<p>Building an efficient API involves many aspects to consider, and most of all, requires a good knowledge of HTTP. It's time-consuming at first sight, but once you know what you're doing, what your needs are in terms of features, it's pretty straightforward. Considering all aspects right at the beginning, like security or the database architecture and how you would like to expose it, is key. That's what is called designing an architecture, and one should pay heed to it. When properly and carefully done, the API implementation job is fairly easy.</p>
<p>What are the next steps?</p>
<h1 id="add-a-documentation-for-other-developers-who-use-your-api">Add a documentation for other developers who use your API</h1>
<ul>
<li><a href="http://apidocjs.com/">apidoc</a> (I really like this one, very easy)</li>
<li><a href="http://swagger.io/">Swagger.io</a> (good reputation, altough I never tried it)</li>
<li><a href="https://medium.com/@orliesaurus/a-review-of-all-most-common-api-editors-6a720dc4f4e6">A full list of most common API editors</a>.</li>
</ul>
<h1 id="going-further-create-a-cli">Going further: create a CLI</h1>
<p>Make you API public! Create a documentation and a NPM package to ease the work for developers. <a href="https://www.clever-cloud.com/blog/features/2015/09/21/Public-API-available/">Read how Clever Cloud did it</a>.</p>
<p><a href="https://www.npmjs.com/package/cliparse">cliparse</a></p>
<h1 id="quick-example-with-expressjs">Quick example with Express.js</h1>
<p><a href="http://expressjs.com/">Express</a> ease the process of developing APIs with Javascript so much! You should definitely give it a try!</p>
<div class="highlight"><pre><span></span><code>npm init
npm install -g express <span class="c1"># Globally, to be able to use the CLI of express</span>
npm install -S express <span class="c1"># Locally, added as a dependency</span>
</code></pre></div>

<p>Here is how to define a little API with Express (I only wrote the most important lines). Every controller defines many functions to handle the end-points (storing data into the database, etc.).</p>
<p>In this example, the access to all the end-points is restricted, with a <a href="http://expressjs.com/guide/using-middleware.html">middleware</a> called <code>auth</code>. The clients need to provide specific headers in order to perfom actions with the API.</p>
<div class="highlight"><pre><span></span><code><span class="kd">var</span><span class="w"> </span><span class="nx">express</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">require</span><span class="p">(</span><span class="s1">&#39;express&#39;</span><span class="p">);</span><span class="w"></span>

<span class="c1">// Controllers</span><span class="w"></span>
<span class="kd">var</span><span class="w"> </span><span class="nx">usersController</span><span class="w">       </span><span class="o">=</span><span class="w"> </span><span class="nx">require</span><span class="p">(</span><span class="s1">&#39;cloud/controllers/users.js&#39;</span><span class="p">),</span><span class="w"></span>
<span class="w">    </span><span class="nx">categoriesController</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="nx">require</span><span class="p">(</span><span class="s1">&#39;cloud/controllers/category.js&#39;</span><span class="p">);</span><span class="w"></span>

<span class="c1">// Configuration</span><span class="w"></span>
<span class="kd">var</span><span class="w"> </span><span class="nx">app</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="nx">express</span><span class="p">(),</span><span class="w"></span>
<span class="w">    </span><span class="nx">auth</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">require</span><span class="p">(</span><span class="s1">&#39;cloud/functions/security&#39;</span><span class="p">);</span><span class="w"></span>

<span class="nx">app</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span><span class="nx">express</span><span class="p">.</span><span class="nx">methodOverride</span><span class="p">());</span><span class="w"> </span><span class="c1">// Allow PUT and DELETE</span><span class="w"></span>

<span class="cm">/*** API ***/</span><span class="w"></span>
<span class="c1">// Users</span><span class="w"></span>
<span class="nx">app</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;/users&#39;</span><span class="p">,</span><span class="w">             </span><span class="nx">auth</span><span class="p">.</span><span class="nx">users</span><span class="p">,</span><span class="w"> </span><span class="nx">usersController</span><span class="p">.</span><span class="nx">all</span><span class="p">);</span><span class="w"></span>
<span class="nx">app</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;/users/:id&#39;</span><span class="p">,</span><span class="w">         </span><span class="nx">auth</span><span class="p">.</span><span class="nx">users</span><span class="p">,</span><span class="w"> </span><span class="nx">usersController</span><span class="p">.</span><span class="nx">get</span><span class="p">);</span><span class="w"></span>
<span class="nx">app</span><span class="p">.</span><span class="nx">post</span><span class="p">(</span><span class="s1">&#39;/users&#39;</span><span class="p">,</span><span class="w">            </span><span class="nx">auth</span><span class="p">.</span><span class="nx">users</span><span class="p">,</span><span class="w"> </span><span class="nx">usersController</span><span class="p">.</span><span class="nx">signup</span><span class="p">);</span><span class="w"></span>
<span class="nx">app</span><span class="p">.</span><span class="nx">post</span><span class="p">(</span><span class="s1">&#39;/users/login&#39;</span><span class="p">,</span><span class="w">      </span><span class="nx">auth</span><span class="p">.</span><span class="nx">users</span><span class="p">,</span><span class="w"> </span><span class="nx">usersController</span><span class="p">.</span><span class="nx">login</span><span class="p">);</span><span class="w"></span>
<span class="nx">app</span><span class="p">.</span><span class="nx">put</span><span class="p">(</span><span class="s1">&#39;/users/:id&#39;</span><span class="p">,</span><span class="w">         </span><span class="nx">auth</span><span class="p">.</span><span class="nx">users</span><span class="p">,</span><span class="w"> </span><span class="nx">usersController</span><span class="p">.</span><span class="nx">edit</span><span class="p">);</span><span class="w"></span>
<span class="nx">app</span><span class="p">.</span><span class="nx">_delete</span><span class="p">(</span><span class="s1">&#39;/users/:id&#39;</span><span class="p">,</span><span class="w">     </span><span class="nx">auth</span><span class="p">.</span><span class="nx">users</span><span class="p">,</span><span class="w"> </span><span class="nx">usersController</span><span class="p">.</span><span class="nx">_delete</span><span class="p">);</span><span class="w"></span>

<span class="c1">// In case of failure</span><span class="w"></span>
<span class="nx">app</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span><span class="w"> </span><span class="nx">req</span><span class="p">,</span><span class="w"> </span><span class="nx">res</span><span class="p">,</span><span class="w"> </span><span class="nx">next</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="c1">// Some logging</span><span class="w"></span>
<span class="w">    </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">err</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="nx">res</span><span class="p">.</span><span class="nx">status</span><span class="p">(</span><span class="nx">err</span><span class="p">.</span><span class="nx">code</span><span class="p">).</span><span class="nx">json</span><span class="p">({</span><span class="nx">error</span><span class="o">:</span><span class="w"> </span><span class="nx">err</span><span class="p">.</span><span class="nx">message</span><span class="p">});</span><span class="w"></span>
<span class="p">});</span><span class="w"></span>

<span class="c1">// Let it beee</span><span class="w"></span>
<span class="nx">app</span><span class="p">.</span><span class="nx">listen</span><span class="p">();</span><span class="w"></span>
</code></pre></div>

<p>That's it! With only a few lines, you can easily get a working API.</p>
<p>This is now the end of this article, hope it will help you! Any feedback appreciated ;)</p>
<hr>
<h1 id="tldr">TL;DR</h1>
<p>Here is a little recap of everything above:</p>
<ul>
<li>End-points represent either an individual resource or a collection of resources</li>
<li>Use HTTPS verbs: <strong>GET</strong>, <strong>PUT</strong>, <strong>POST</strong> and <strong>DELETE</strong></li>
<li>Use HTTP status codes (those already existing or yours)</li>
<li>Use JSON</li>
<li>The body must only contain the requested information. It can be either:</li>
<li><strong>A resource or partial details about a resource</strong> (JSON object)</li>
<li><strong>A list of resources</strong> (JSON array): also provide full link with each resource (<a href="https://my-api/users/123">https://my-api/users/123</a> for example)</li>
<li>Metadata must be put inside headers</li>
<li>Number of rows when returning a list of results (added by the server)</li>
<li>Secret keys for authentication/restricting access to the API (added by the client)</li>
<li>Cookies for user management</li>
<li>Use the <code>Location</code> header (with the status code <em>201 Created</em>, but without a body) after creating a resource with <strong>POST</strong>, to give the resource's link</li>
<li>Use query parameters</li>
<li>Filtering: <code>GET /users?country=US&amp;age=21</code></li>
<li>Sorting: <code>GET /users?sortBy=name</code></li>
<li>Pagination: <code>GET /users?pageAfter=3</code><ul>
<li>Always enable pagination on any collection, even for the small ones</li>
<li>Pagination must be based on "<em>after a resource's identifier</em>" or "<em>before a resource's identifier</em>" to avoid duplicate content across pages</li>
<li>Use the status code 200 when the entire collection fits in one page, otherwise 206</li>
</ul>
</li>
</ul>
<h1 id="going-further">Going further</h1>
<ul>
<li><a href="https://speakerdeck.com/dzuelke/designing-http-interfaces-and-restful-web-services-sfliveparis2012-2012-06-08">Designing HTTP Interfaces and RESTful Web Services (SFLiveParis2012 2012-06-08)</a></li>
<li><a href="https://nakedsecurity.sophos.com/2013/11/20/serious-security-how-to-store-your-users-passwords-safely/">Serious Security: How to store your users' passwords safely</a></li>
<li><a href="https://securitychecklist.org/">securitychecklist.org</a></li>
<li><a href="https://www.youtube.com/watch?v=_k60dxlMjZ4">[DevFest Nantes 2015] REST from zero to hero in 45 minutes</a></li>
<li><a href="https://float-middle.com/json-web-tokens-jwt-vs-sessions/">JSON Web Tokens (JWT) vs Sessions</a></li>
<li><a href="https://ponyfoo.com/articles/json-web-tokens-vs-session-cookies">JSON Web Tokens vs. Session Cookies: In Practice</a></li>
<li><a href="https://blog.appcanary.com/2017/http-security-headers.html">Everything you need to know about HTTP security headers</a></li>
<li><a href="https://kev.inburke.com/kevin/things-to-use-instead-of-jwt/">Things to Use Instead of JWT</a></li>
</ul>
</article>
<footer class="grey italic small">
    Last update: Sat 24 September 2022</footer>

        </div> <!-- WRAPPER -->
    </body>
</html>